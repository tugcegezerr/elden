<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=devicewidth, initial-scale=1.0">
    <title>SatÄ±cÄ± Anasayfa â€“ El'den</title>

    <!-- Genel site CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- SatÄ±cÄ±ya Ã¶zel CSS -->
    <link rel="stylesheet" href="css/style_satici.css">
</head>

<body>

<!-- =============================
       SATICI HEADER
============================= -->
<header class="satici-header">
    <a href="satici_anasayfa.html" class="logo">
        <span class="logo-text">el'den</span>
    </a>

    <nav class="satici-nav">
        <a onclick="location.reload()">Anasayfa</a>
        <a onclick="popupAc('popupUrunEkle')">ÃœrÃ¼n Ekle</a>
        <a onclick="bildirimleriGoster()">Bildirimler</a>
        <a onclick="profilGoster()">Profil</a>
        <a onclick="cikisYap()">Ã‡Ä±kÄ±ÅŸ Yap</a>
    </nav>
</header>


<!-- =============================
       HERO (AlÄ±cÄ± ile aynÄ±)
============================= -->
<div class="ana-foto">
    SatÄ±cÄ± Paneli
</div>


<!-- =============================
       KATEGORÄ°LER (AlicÄ± ile aynÄ±)
============================= -->
<div class="kategoriler">
  <div class="kategori" onclick="kategoriFiltre('Ev Yemekleri')">
      <img src="resimler/evyemekleri.jpg"><p>Ev Yemekleri</p>
  </div>

  <div class="kategori" onclick="kategoriFiltre('El Ä°ÅŸleri')">
      <img src="resimler/elisleri.jpg"><p>El Ä°ÅŸleri</p>
  </div>

  <div class="kategori" onclick="kategoriFiltre('Organik')">
      <img src="resimler/organik.jpg"><p>Organik ÃœrÃ¼nler</p>
  </div>

  <div class="kategori" onclick="kategoriFiltre('TatlÄ±lar')">
      <img src="resimler/tatli.jpg"><p>TatlÄ±lar</p>
  </div>
</div>


<!-- =============================
     SADECE SATICININ ÃœRÃœNLERÄ°
============================= -->
<h2 id="urun-listesi-baslik" style="text-align:center;margin-top:20px;">ÃœrÃ¼nleriniz</h2>
<div class="urunler" id="urun-listesi"></div>


<!-- =============================
       POPUP ARKA & KUTULARI
============================= -->
<div id="popupArka" class="popup-arka" style="display:none;"></div>

<!-- ÃœRÃœN EKLE POPUP -->
<div id="popupUrunEkle" class="popup-kutu" style="display:none;">
    <span class="kapat" onclick="popupKapat()">&times;</span>
    <h2>ÃœrÃ¼n Ekle</h2>

    <input id="pAd" type="text" placeholder="ÃœrÃ¼n adÄ±">
    <input id="pFiyat" type="number" placeholder="Fiyat">
    <input id="pResimFile" type="file" accept="image/*">
    <input id="pKategori" type="text" placeholder="Kategori">
    <button onclick="popupUrunEkleKaydet()">Kaydet</button>
</div>

<!-- BÄ°LDÄ°RÄ°MLER POPUP -->
<div id="popupBildirim" class="popup-kutu" style="display:none;">
    <span class="kapat" onclick="popupKapat()">&times;</span>
    <h2>Bildirimler</h2>
    <div id="popupBildirimListesi"></div>
</div>

<!-- PROFÄ°L POPUP (DÃœZENLENEBÄ°LÄ°R) -->
<div id="popupProfil" class="popup-kutu" style="display:none;">
    <span class="kapat" onclick="popupKapat()">&times;</span>
    <h2>Profil Bilgileri</h2>

    <label>Ad Soyad</label>
    <input id="pAdSoyad" type="text">

    <label>Mail</label>
    <input id="pMail" type="email" disabled>

    <label>Telefon</label>
    <input id="pTelefon" type="text">

    <label>Åifre</label>
    <input id="pSifre" type="password">

    <button onclick="profilKaydet()">Kaydet</button>
</div>

<!-- ÃœRÃœN DETAY POPUP -->
<div id="popupUrunDetay" class="popup-kutu" style="display:none;">
    <span class="kapat" onclick="popupKapat()">&times;</span>
    <h2 id="detayBaslik">ÃœrÃ¼n DetayÄ±</h2>

    <img id="detayResim" style="width:100%;height:200px;object-fit:cover;border-radius:8px;margin-bottom:10px;">

    <p><strong>Fiyat:</strong> <span id="detayFiyat"></span> â‚º</p>
    <p><strong>Kategori:</strong> <span id="detayKategori"></span></p>
    <p><strong>Malzemeler / Ä°Ã§erik:</strong></p>
    <p id="detayAciklama"></p>

    <button onclick="urunDetayDuzenle()">DÃ¼zenle</button>
    <button onclick="urunDetaySil()" style="background:#c93d3d;margin-top:10px;">Sil</button>
</div>

<!-- ÃœRÃœN DÃœZENLE POPUP -->
<!-- ÃœRÃœN DÃœZENLE POPUP -->
<div id="popupUrunDuzenle" class="popup-kutu" style="display:none;">
    <span class="kapat" onclick="popupKapat()">&times;</span>

    <h2 style="text-align:center; margin-bottom: 20px;">ÃœrÃ¼nÃ¼ DÃ¼zenle</h2>

    <div class="form-grup">
        <label>Ad</label>
        <input id="dAd" type="text">
    </div>

    <div class="form-grup">
        <label>Fiyat (â‚º)</label>
        <input id="dFiyat" type="number" min="0">
    </div>

    <div class="form-grup">
        <label>Kategori</label>
        <input id="dKategori" type="text">
    </div>

    <div class="form-grup">
        <label>Malzemeler / Ä°Ã§erik</label>
        <textarea id="dAciklama" rows="4"></textarea>
    </div>

    <div class="form-grup">
        <label>Resim</label>
        <input id="dResimFile" type="file" accept="image/*">
        <img id="duzenleOnizleme" style="width:100%; margin-top:10px; border-radius:8px; display:none;">
    </div>

    <button class="kaydetBtn" onclick="urunGuncelle()">Kaydet</button>
    <button class="silBtn" onclick="urunDetaySil()" style="background:#c93d3d;">Sil</button>
</div>





<!-- =============================
       JAVASCRIPT DOSYALARI
============================= -->
<script src="js/urunler.js"></script>
<script src="js/auth.js"></script>

<script>
/* POPUP AÃ‡ - KAPAT */
function popupAc(id) {
    document.getElementById("popupArka").style.display = "block";
    document.getElementById(id).style.display = "block";
}

function popupKapat() {
    document.getElementById("popupArka").style.display = "none";
    ["popupUrunEkle","popupBildirim","popupProfil"].forEach(id=>{
        document.getElementById(id).style.display = "none";
    });
}

/* ÃœRÃœN EKLE KAYDET */
async function popupUrunEkleKaydet() {
    let aktif = JSON.parse(localStorage.getItem("aktifKullanici"));
    let liste = JSON.parse(localStorage.getItem("eTicaretUrunler")) || [];

    let ad = pAd.value.trim();
    let fiyat = Number(pFiyat.value);
    let kategori = pKategori.value.trim();
    let file = document.getElementById("pResimFile").files[0];

    if (!ad || !fiyat || !kategori || !file) {
        alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun ve bir resim seÃ§in.");
        return;
    }

    // ğŸ”¥ Resmi Base64'e dÃ¶nÃ¼ÅŸtÃ¼r
    let resimBase64 = await resimToBase64(file);

    // Yeni Ã¼rÃ¼n oluÅŸtur
    let urun = {
        id: Date.now(),
        ad,
        fiyat,
        kategori,
        resim: resimBase64,     // â† seÃ§ilen dosya artÄ±k Base64 olarak burada!
        saticiMail: aktif.mail
    };

    liste.push(urun);
    localStorage.setItem("eTicaretUrunler", JSON.stringify(liste));

    alert("ÃœrÃ¼n eklendi!");
    popupKapat();
    location.reload();
}


/* BÄ°LDÄ°RÄ°M POPUP */
function bildirimleriGoster() {
    let alan = document.getElementById("popupBildirimListesi");
    alan.innerHTML = "<p>Åu anda bildiriminiz yok.</p>";
    popupAc("popupBildirim");
}

/* PROFÄ°L POPUP */
function profilGoster() {
    let aktif = JSON.parse(localStorage.getItem("aktifKullanici"));

    document.getElementById("pAdSoyad").value = aktif.ad;
    document.getElementById("pMail").value = aktif.mail;
    document.getElementById("pTelefon").value = aktif.tel;
    document.getElementById("pSifre").value = aktif.sifre;

    popupAc("popupProfil");
}

function profilKaydet() {
    let aktif = JSON.parse(localStorage.getItem("aktifKullanici"));

    let ad = document.getElementById("pAdSoyad").value.trim();
    let mail = document.getElementById("pMail").value.trim();
    let tel = document.getElementById("pTelefon").value.trim();
    let sifre = document.getElementById("pSifre").value.trim();

    if (!ad || !mail || !tel || !sifre) {
        alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun.");
        return;
    }

    // Eski mail anahtarÄ±ndaki kaydÄ± siliyoruz
    localStorage.removeItem(aktif.mail);

    // Yeni bilgileri kaydediyoruz
    aktif.ad = ad;
    aktif.mail = mail;
    aktif.tel = tel;
    aktif.sifre = sifre;

    // Yeni mail anahtarÄ±yla kayÄ±t
    localStorage.setItem(mail, JSON.stringify(aktif));

    // Aktif kullanÄ±cÄ± kaydÄ±nÄ± gÃ¼ncelle
    localStorage.setItem("aktifKullanici", JSON.stringify(aktif));

    alert("Profil bilgileri gÃ¼ncellendi!");
    popupKapat();
    location.reload();
}

let seciliUrun = null;

function urunDetayAc(id) {
    let liste = JSON.parse(localStorage.getItem("eTicaretUrunler")) || [];
    seciliUrun = liste.find(u => u.id === id);

    document.getElementById("detayBaslik").textContent = seciliUrun.ad;
    document.getElementById("detayResim").src = seciliUrun.resim;
    document.getElementById("detayFiyat").textContent = seciliUrun.fiyat;
    document.getElementById("detayKategori").textContent = seciliUrun.kategori;
    document.getElementById("detayAciklama").textContent = seciliUrun.aciklama || "Bilgi eklenmemiÅŸ.";

    popupAc("popupUrunDetay");
}

function urunDetayDuzenle() {
    popupKapat();

    document.getElementById("dAd").value = seciliUrun.ad;
    document.getElementById("dFiyat").value = seciliUrun.fiyat;
    document.getElementById("dKategori").value = seciliUrun.kategori;
    document.getElementById("dAciklama").value = seciliUrun.aciklama || "";

    popupAc("popupUrunDuzenle");
}

function urunDetaySil() {
    if (!confirm("Bu Ã¼rÃ¼nÃ¼ silmek istiyor musunuz?")) return;

    let liste = JSON.parse(localStorage.getItem("eTicaretUrunler")) || [];
    liste = liste.filter(u => u.id !== seciliUrun.id);

    localStorage.setItem("eTicaretUrunler", JSON.stringify(liste));

    alert("ÃœrÃ¼n silindi.");
    popupKapat();
    location.reload();
}

async function urunGuncelle() {
    let liste = JSON.parse(localStorage.getItem("eTicaretUrunler")) || [];
    let index = liste.findIndex(u => u.id === seciliUrun.id);

    let yeniResim = liste[index].resim;
    let file = document.getElementById("dResimFile").files[0];

    if (file) {
        yeniResim = await resimToBase64(file);
    }

    liste[index] = {
        ...liste[index],
        ad: document.getElementById("dAd").value,
        fiyat: Number(document.getElementById("dFiyat").value),
        kategori: document.getElementById("dKategori").value,
        aciklama: document.getElementById("dAciklama").value,
        resim: yeniResim,
    };

    localStorage.setItem("eTicaretUrunler", JSON.stringify(liste));

    alert("ÃœrÃ¼n gÃ¼ncellendi!");
    popupKapat();
    location.reload();
}





/* SAYFA AÃ‡ILINCA â†’ SADECE KENDÄ° ÃœRÃœNLERÄ°NÄ° LÄ°STELE */
document.addEventListener("DOMContentLoaded", () => {
    let aktif = JSON.parse(localStorage.getItem("aktifKullanici"));
    let tumUrunler = JSON.parse(localStorage.getItem("eTicaretUrunler")) || [];

    let liste = tumUrunler.filter(u => u.saticiMail === aktif.mail);

    urunleriListele(liste);
});



</script>

</body>
</html>
